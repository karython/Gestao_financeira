<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestão Financeira Pessoal</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="static/css/styles.css"/>
    <link rel="icon" href="./static/img/lucro.png">
    
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // API Base URL
        const API_BASE = 'https://gestao-financeira-tmqc.onrender.com';

        // API Helper Functions
        const apiRequest = async (endpoint, options = {}) => {
            const token = localStorage.getItem('token');
            const headers = {
                'Content-Type': 'application/json',
                ...options.headers
            };

            if (token) {
                headers['Authorization'] = `Bearer ${token}`;
            }

            const response = await fetch(`${API_BASE}${endpoint}`, {
                ...options,
                headers
            });

            if (!response.ok) {
                if (response.status === 401) {
                    localStorage.removeItem('token');
                    localStorage.removeItem('currentUser');
                    window.location.reload();
                }
                throw new Error(`API Error: ${response.status}`);
            }

            return response.json();
        };

        // Auth API
        const authAPI = {
            login: (email, password) => apiRequest('/auth/login/', {
                method: 'POST',
                body: JSON.stringify({ email, password })
            }),
            register: (userData) => apiRequest('/auth/register/', {
                method: 'POST',
                body: JSON.stringify(userData)
            }),
            getProfile: () => apiRequest('/auth/profile/'),
            updateProfile: (userData) => apiRequest('/auth/profile/', {
                method: 'PUT',
                body: JSON.stringify(userData)
            })
        };

        // Categories API
        const categoriesAPI = {
            list: () => apiRequest('/categories/'),
            create: (category) => apiRequest('/categories/', {
                method: 'POST',
                body: JSON.stringify(category)
            }),
            update: (id, category) => apiRequest(`/categories/${id}/`, {
                method: 'PUT',
                body: JSON.stringify(category)
            }),
            delete: (id) => apiRequest(`/categories/${id}/`, {
                method: 'DELETE'
            })
        };

        // Expenses API
        const expensesAPI = {
            list: (params = {}) => {
                const query = new URLSearchParams(params).toString();
                return apiRequest(`/expenses/?${query}`);
            },
            create: (expense) => apiRequest('/expenses/', {
                method: 'POST',
                body: JSON.stringify(expense)
            }),
            update: (id, expense) => apiRequest(`/expenses/${id}/`, {
                method: 'PUT',
                body: JSON.stringify(expense)
            }),
            delete: (id) => apiRequest(`/expenses/${id}/`, {
                method: 'DELETE'
            })
        };

        // Fixed Expenses API
        const fixedExpensesAPI = {
            list: () => apiRequest('/fixed-expenses/'),
            create: (expense) => apiRequest('/fixed-expenses/', {
                method: 'POST',
                body: JSON.stringify(expense)
            }),
            update: (id, expense) => apiRequest(`/fixed-expenses/${id}/`, {
                method: 'PUT',
                body: JSON.stringify(expense)
            }),
            delete: (id) => apiRequest(`/fixed-expenses/${id}/`, {
                method: 'DELETE'
            })
        };

        // Income API
        const incomeAPI = {
            get: () => apiRequest('/income/'),
            update: (income) => apiRequest('/income/', {
                method: 'PUT',
                body: JSON.stringify(income)
            }),
            listVariable: () => apiRequest('/income/variable/'),
            createVariable: (income) => apiRequest('/income/variable/', {
                method: 'POST',
                body: JSON.stringify(income)
            }),
            updateVariable: (id, income) => apiRequest(`/income/variable/${id}/`, {
                method: 'PUT',
                body: JSON.stringify(income)
            }),
            deleteVariable: (id) => apiRequest(`/income/variable/${id}/`, {
                method: 'DELETE'
            }),
            listFixed: () => apiRequest('/income/fixed/'),
            createFixed: (income) => apiRequest('/income/fixed/', {
                method: 'POST',
                body: JSON.stringify(income)
            }),
            updateFixed: (id, income) => apiRequest(`/income/fixed/${id}/`, {
                method: 'PUT',
                body: JSON.stringify(income)
            }),
            deleteFixed: (id) => apiRequest(`/income/fixed/${id}/`, {
                method: 'DELETE'
            })
        };

        // Dashboard API
        const dashboardAPI = {
            stats: () => apiRequest('/dashboard/stats/'),
            recentTransactions: (limit = 10) => apiRequest(`/dashboard/recent-transactions/?limit=${limit}`)
        };

        // Reports API
        const reportsAPI = {
            generate: (params) => {
                const query = new URLSearchParams(params).toString();
                return apiRequest(`/reports/generate/?${query}`);
            }
        };

        // Analytics API
        const analyticsAPI = {
            summary: (month, year) => apiRequest(`/analytics/summary/?month=${month}&year=${year}`),
            chartData: (filter, period, month, year) => {
                const params = new URLSearchParams({ filter, period, year });
                if (month) params.append('month', month);
                return apiRequest(`/analytics/chart-data/?${params}`);
            }
        };

        const App = () => {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [currentUser, setCurrentUser] = useState(null);
            const [currentView, setCurrentView] = useState('dashboard');
            const [sidebarOpen, setSidebarOpen] = useState(false);

            useEffect(() => {
                const user = localStorage.getItem('currentUser');
                if (user) {
                    setCurrentUser(JSON.parse(user));
                    setIsAuthenticated(true);
                }
            }, []);

            const handleLogin = (userData) => {
                localStorage.setItem('currentUser', JSON.stringify(userData));
                setCurrentUser(userData);
                setIsAuthenticated(true);
            };

            const handleLogout = () => {
                localStorage.removeItem('currentUser');
                setCurrentUser(null);
                setIsAuthenticated(false);
                setCurrentView('dashboard');
            };

            if (!isAuthenticated) {
                return <LoginScreen onLogin={handleLogin} />;
            }

            return (
                <div className="app-container">
                    <button className="hamburger" onClick={() => setSidebarOpen(!sidebarOpen)}>
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                    
                    <Sidebar 
                        currentView={currentView} 
                        setCurrentView={setCurrentView}
                        onLogout={handleLogout}
                        isOpen={sidebarOpen}
                    />
                    
                    <div className="main-content">
                        <MainContent 
                            currentView={currentView}
                            currentUser={currentUser}
                            setCurrentUser={setCurrentUser}
                        />
                    </div>
                </div>
            );
        };

        const LoginScreen = ({ onLogin }) => {
            const [isRegister, setIsRegister] = useState(false);
            const [formData, setFormData] = useState({
                name: '',
                email: '',
                password: ''
            });
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                setError('');

                try {
                    if (isRegister) {
                        const response = await authAPI.register(formData);
                        const loginResponse = await authAPI.login(formData.email, formData.password);
                        localStorage.setItem('token', loginResponse.access_token);
                        onLogin({ ...response, token: loginResponse.access_token });
                    } else {
                        const response = await authAPI.login(formData.email, formData.password);
                        localStorage.setItem('token', response.access_token);
                        const profile = await authAPI.getProfile();
                        onLogin({ ...profile, token: response.access_token });
                    }
                } catch (err) {
                    setError('Erro no login/cadastro. Verifique suas credenciais.');
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="login-container">
                    <div className="login-box">
                        <h2>{isRegister ? 'Cadastro' : 'Login'}</h2>
                        <form onSubmit={handleSubmit}>
                            {isRegister && (
                                <div className="form-group">
                                    <label>Nome</label>
                                    <input
                                        type="text"
                                        required
                                        value={formData.name}
                                        onChange={(e) => setFormData({...formData, name: e.target.value})}
                                    />
                                </div>
                            )}
                            <div className="form-group">
                                <label>Email</label>
                                <input
                                    type="email"
                                    value={formData.email}
                                    onChange={(e) => setFormData({...formData, email: e.target.value})}
                                    placeholder="Digite qualquer email para teste"
                                />
                            </div>
                            <div className="form-group">
                                <label>Senha</label>
                                <input
                                    type="password"
                                    value={formData.password}
                                    onChange={(e) => setFormData({...formData, password: e.target.value})}
                                    placeholder="Digite qualquer senha para teste"
                                />
                            </div>
                            {error && <div style={{color: 'red', marginBottom: '10px'}}>{error}</div>}
                            <button type="submit" className="btn" style={{width: '100%', marginBottom: '15px'}} disabled={loading}>
                                {loading ? 'Carregando...' : (isRegister ? 'Cadastrar' : 'Entrar')}
                            </button>
                        </form>
                        <button
                            onClick={() => setIsRegister(!isRegister)}
                            style={{background: 'none', border: 'none', color: '#52dbf1', cursor: 'pointer', width: '100%', textAlign: 'center'}}
                        >
                            {isRegister ? 'Já tem conta? Faça login' : 'Não tem conta? Cadastre-se'}
                        </button>
                    </div>
                </div>
            );
        };

        const Sidebar = ({ currentView, setCurrentView, onLogout, isOpen }) => {
            const menuItems = [
                { id: 'dashboard', label: 'Dashboard' },
                { id: 'categories', label: 'Categorias' },
                { id: 'expenses', label: 'Lançamentos' },
                { id: 'fixedExpenses', label: 'Despesas Fixas' },
                { id: 'income', label: 'Receitas' },
                { id: 'reports', label: 'Relatórios' },
                { id: 'analysis', label: 'Análises' },
                { id: 'settings', label: 'Configurações' }
            ];

            return (
                <div className={`sidebar ${isOpen ? 'active' : ''}`}>
                    <div className="sidebar-header">
                        <h2>FinControl</h2>
                    </div>
                    {menuItems.map(item => (
                        <button
                            key={item.id}
                            className={`menu-item ${currentView === item.id ? 'active' : ''}`}
                            onClick={() => setCurrentView(item.id)}
                        >
                            {item.label}
                        </button>
                    ))}
                    <button className="menu-item" onClick={onLogout}>
                        Sair
                    </button>
                </div>
            );
        };

        const MainContent = ({ currentView, currentUser, setCurrentUser }) => {
            switch(currentView) {
                case 'dashboard':
                    return <Dashboard />;
                case 'categories':
                    return <Categories />;
                case 'expenses':
                    return <Expenses />;
                case 'fixedExpenses':
                    return <FixedExpenses />;
                case 'income':
                    return <Income />;
                case 'reports':
                    return <Reports />;
                case 'analysis':
                    return <Analysis />;
                case 'settings':
                    return <Settings currentUser={currentUser} setCurrentUser={setCurrentUser} />;
                default:
                    return <Dashboard />;
            }
        };

        const Dashboard = () => {
            const [stats, setStats] = useState({
                total_balance: 0,
                monthly_income: 0,
                monthly_expenses: 0,
                active_categories: 0,
                recentTransactions: []
            });
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                loadDashboardData();
            }, []);

            const loadDashboardData = async () => {
                try {
                    const [statsData, transactions] = await Promise.all([
                        dashboardAPI.stats(),
                        dashboardAPI.recentTransactions()
                    ]);
                    setStats({
                        ...statsData,
                        recentTransactions: transactions
                    });
                } catch (error) {
                    console.error('Erro ao carregar dados do dashboard:', error);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div>
                    <h1 style={{color: '#333', marginBottom: '30px'}}>Dashboard</h1>
                    
                    {loading ? (
                        <div>Carregando...</div>
                    ) : (
                        <div className="stats-grid">
                            <div className="stat-card">
                                <h4>Saldo Total</h4>
                                <div className="value">R$ {parseFloat(stats.total_balance).toFixed(2)}</div>
                            </div>
                            <div className="stat-card">
                                <h4>Receita Mensal</h4>
                                <div className="value">R$ {parseFloat(stats.monthly_income).toFixed(2)}</div>
                            </div>
                            <div className="stat-card">
                                <h4>Despesas Mensal</h4>
                                <div className="value">R$ {parseFloat(stats.monthly_expenses).toFixed(2)}</div>
                            </div>
                            <div className="stat-card">
                                <h4>Categorias Ativas</h4>
                                <div className="value">{stats.active_categories}</div>
                            </div>
                        </div>
                    )}

                    {!loading && (
                        <div className="dashboard-card">
                            <h3>Transações Recentes</h3>
                            {stats.recentTransactions.length > 0 ? (
                                <div className="table-container">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Data</th>
                                                <th>Descrição</th>
                                                <th>Tipo</th>
                                                <th>Valor</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {stats.recentTransactions.map(expense => (
                                                <tr key={expense.id}>
                                                    <td>{new Date(expense.date).toLocaleDateString('pt-BR')}</td>
                                                    <td>{expense.description}</td>
                                                    <td>
                                                        <span className={`badge ${(expense.type || '').toLowerCase() === 'receita' ? 'badge-success' : 'badge-danger'}`}>
                                                                {expense.type}
                                                            </span>
                                                    </td>
                                                    <td>R$ {parseFloat(expense.amount).toFixed(2)}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            ) : (
                                <div className="empty-state">
                                    <p>Nenhuma transação recente</p>
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        };

        const Categories = () => {
            const [categories, setCategories] = useState([]);
            const [showModal, setShowModal] = useState(false);
            const [editingCategory, setEditingCategory] = useState(null);
            const [formData, setFormData] = useState({ name: '', type: 'despesa' });
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                loadCategories();
            }, []);

            const loadCategories = async () => {
                try {
                    const data = await categoriesAPI.list();
                    setCategories(data);
                } catch (error) {
                    console.error('Erro ao carregar categorias:', error);
                } finally {
                    setLoading(false);
                }
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                try {
                    if (editingCategory) {
                        await categoriesAPI.update(editingCategory.id, formData);
                    } else {
                        await categoriesAPI.create(formData);
                    }
                    loadCategories();
                    handleCloseModal();
                } catch (error) {
                    console.error('Erro ao salvar categoria:', error);
                    alert('Erro ao salvar categoria');
                }
            };

            const handleDelete = async (id) => {
                if (confirm('Tem certeza que deseja excluir esta categoria?')) {
                    try {
                        await categoriesAPI.delete(id);
                        loadCategories();
                    } catch (error) {
                        console.error('Erro ao excluir categoria:', error);
                        alert('Erro ao excluir categoria');
                    }
                }
            };

            const handleEdit = (category) => {
                setEditingCategory(category);
                setFormData({ name: category.name, type: category.type });
                setShowModal(true);
            };

            const handleCloseModal = () => {
                setShowModal(false);
                setEditingCategory(null);
                setFormData({ name: '', type: 'despesa' });
            };

            return (
                <div>
                    <h1 style={{color: '#333', marginBottom: '30px'}}>Categorias</h1>
                    
                    <button className="btn" onClick={() => setShowModal(true)} style={{marginBottom: '20px'}}>
                        Nova Categoria
                    </button>

                    <div className="dashboard-card">
                        <h3>Lista de Categorias</h3>
                        {loading ? (
                            <div>Carregando...</div>
                        ) : categories.length > 0 ? (
                            <div className="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Nome</th>
                                            <th>Tipo</th>
                                            <th>Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {categories.map(category => (
                                            <tr key={category.id}>
                                                <td>{category.name}</td>
                                                <td>
                                                    <span className={`badge ${(category.type || '').toLowerCase() === 'receita' ? 'badge-success' : 'badge-danger'}`}>
                                                        {category.type}
                                                    </span>
                                                </td>
                                                <td>
                                                    <div className="action-buttons">
                                                        <button className="btn btn-secondary" onClick={() => handleEdit(category)}>
                                                            Editar
                                                        </button>
                                                        <button className="btn btn-danger" onClick={() => handleDelete(category.id)}>
                                                            Excluir
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        ) : (
                            <div className="empty-state">
                                <p>Nenhuma categoria cadastrada</p>
                            </div>
                        )}
                    </div>

                    {showModal && (
                        <div className="modal-overlay" onClick={handleCloseModal}>
                            <div className="modal" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <h3>{editingCategory ? 'Editar Categoria' : 'Nova Categoria'}</h3>
                                    <button className="close-btn" onClick={handleCloseModal}>×</button>
                                </div>
                                <form onSubmit={handleSubmit}>
                                    <div className="form-group">
                                        <label>Nome da Categoria</label>
                                        <input
                                            type="text"
                                            required
                                            value={formData.name}
                                            onChange={(e) => setFormData({...formData, name: e.target.value})}
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>Tipo</label>
                                        <select
                                            value={formData.type}
                                            onChange={(e) => setFormData({...formData, type: e.target.value})}
                                        >
                                            <option value="despesa">Despesa</option>
                                            <option value="receita">Receita</option>
                                        </select>
                                    </div>
                                    <button type="submit" className="btn">
                                        {editingCategory ? 'Salvar' : 'Adicionar'}
                                    </button>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const Expenses = () => {
            const [expenses, setExpenses] = useState([]);
            const [categories, setCategories] = useState([]);
            const [showModal, setShowModal] = useState(false);
            const [editingExpense, setEditingExpense] = useState(null);
            const [formData, setFormData] = useState({
                description: '',
                amount: '',
                categoryId: '',
                date: '',
                type: 'despesa'
            });
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                loadExpenses();
                loadCategories();
            }, []);

            const loadExpenses = async () => {
                try {
                    const data = await expensesAPI.list();
                    setExpenses(data);
                } catch (error) {
                    console.error('Erro ao carregar lançamentos:', error);
                } finally {
                    setLoading(false);
                }
            };

            const loadCategories = async () => {
                try {
                    const data = await categoriesAPI.list();
                    setCategories(data);
                } catch (error) {
                    console.error('Erro ao carregar categorias:', error);
                }
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                try {
                    const expenseData = {
                        ...formData,
                        amount: parseFloat(formData.amount),
                        category_id: parseInt(formData.categoryId)
                    };
                    delete expenseData.categoryId;

                    if (editingExpense) {
                        await expensesAPI.update(editingExpense.id, expenseData);
                    } else {
                        await expensesAPI.create(expenseData);
                    }
                    loadExpenses();
                    handleCloseModal();
                } catch (error) {
                    console.error('Erro ao salvar lançamento:', error);
                    alert('Erro ao salvar lançamento');
                }
            };

            const handleDelete = async (id) => {
                if (confirm('Tem certeza que deseja excluir este lançamento?')) {
                    try {
                        await expensesAPI.delete(id);
                        loadExpenses();
                    } catch (error) {
                        console.error('Erro ao excluir lançamento:', error);
                        alert('Erro ao excluir lançamento');
                    }
                }
            };

            const handleEdit = (expense) => {
                setEditingExpense(expense);
                setFormData({
                    description: expense.description,
                    amount: expense.amount.toString(),
                    categoryId: expense.category_id.toString(),
                    date: expense.date,
                    type: expense.type
                });
                setShowModal(true);
            };

            const handleCloseModal = () => {
                setShowModal(false);
                setEditingExpense(null);
                setFormData({
                    description: '',
                    amount: '',
                    categoryId: '',
                    date: '',
                    type: 'despesa'
                });
            };

            return (
                <div>
                    <h1 style={{color: '#333', marginBottom: '30px'}}>Lançamentos</h1>
                    
                    <button className="btn" onClick={() => setShowModal(true)} style={{marginBottom: '20px'}}>
                        Novo Lançamento
                    </button>

                    <div className="dashboard-card">
                        <h3>Lista de Lançamentos</h3>
                        {loading ? (
                            <div>Carregando...</div>
                        ) : expenses.length > 0 ? (
                            <div className="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Data</th>
                                            <th>Descrição</th>
                                            <th>Categoria</th>
                                            <th>Tipo</th>
                                            <th>Valor</th>
                                            <th>Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {expenses.map(expense => {
                                            const category = categories.find(c => c.id === expense.category_id);
                                            return (
                                                <tr key={expense.id}>
                                                    <td>{new Date(expense.date).toLocaleDateString('pt-BR')}</td>
                                                    <td>{expense.description}</td>
                                                    <td>{category?.name || 'Sem categoria'}</td>
                                                    <td>
                                                        <span className={`badge ${(expense.type || '').toLowerCase() === 'receita' ? 'badge-success' : 'badge-danger'}`}>
                                                            {expense.type}
                                                        </span>
                                                    </td>
                                                    <td>R$ {parseFloat(expense.amount).toFixed(2)}</td>
                                                    <td>
                                                        <div className="action-buttons">
                                                            <button className="btn btn-secondary" onClick={() => handleEdit(expense)}>
                                                                Editar
                                                            </button>
                                                            <button className="btn btn-danger" onClick={() => handleDelete(expense.id)}>
                                                                Excluir
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                        ) : (
                            <div className="empty-state">
                                <p>Nenhum lançamento cadastrado</p>
                            </div>
                        )}
                    </div>

                    {showModal && (
                        <div className="modal-overlay" onClick={handleCloseModal}>
                            <div className="modal" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <h3>{editingExpense ? 'Editar Lançamento' : 'Novo Lançamento'}</h3>
                                    <button className="close-btn" onClick={handleCloseModal}>×</button>
                                </div>
                                <form onSubmit={handleSubmit}>
                                    <div className="form-group">
                                        <label>Descrição</label>
                                        <input
                                            type="text"
                                            required
                                            value={formData.description}
                                            onChange={(e) => setFormData({...formData, description: e.target.value})}
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>Valor</label>
                                        <input
                                            type="number"
                                            step="0.01"
                                            required
                                            value={formData.amount}
                                            onChange={(e) => setFormData({...formData, amount: e.target.value})}
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>Categoria</label>
                                        <select
                                            required
                                            value={formData.categoryId}
                                            onChange={(e) => setFormData({...formData, categoryId: e.target.value})}
                                        >
                                            <option value="">Selecione...</option>
                                            {categories.filter(c => (c.type || '').toLowerCase() === (formData.type || '').toLowerCase()).map(category => (
                                                <option key={category.id} value={category.id}>
                                                    {category.name}
                                                </option>
                                            ))}
                                        </select>
                                    </div>
                                    <div className="form-group">
                                        <label>Data</label>
                                        <input
                                            type="date"
                                            required
                                            value={formData.date}
                                            onChange={(e) => setFormData({...formData, date: e.target.value})}
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>Tipo</label>
                                        <select
                                            value={formData.type}
                                            onChange={(e) => setFormData({...formData, type: e.target.value})}
                                        >
                                            <option value="despesa">Despesa</option>
                                            <option value="receita">Receita</option>
                                        </select>
                                    </div>
                                    <button type="submit" className="btn">
                                        {editingExpense ? 'Salvar' : 'Adicionar'}
                                    </button>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const FixedExpenses = () => {
            const [fixedExpenses, setFixedExpenses] = useState([]);
            const [categories, setCategories] = useState([]);
            const [showModal, setShowModal] = useState(false);
            const [editingExpense, setEditingExpense] = useState(null);
            const [formData, setFormData] = useState({
                description: '',
                amount: '',
                category_id: '',
                day_of_month: ''
            });
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                loadFixedExpenses();
                loadCategories();
            }, []);

            const loadFixedExpenses = async () => {
                try {
                    const data = await fixedExpensesAPI.list();
                    setFixedExpenses(data);
                } catch (error) {
                    console.error('Erro ao carregar despesas fixas:', error);
                } finally {
                    setLoading(false);
                }
            };

            const loadCategories = async () => {
                try {
                    const data = await categoriesAPI.list();
                    setCategories(data.filter(c => (c.type || '').toLowerCase() === 'despesa'));
                } catch (error) {
                    console.error('Erro ao carregar categorias:', error);
                }
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                try {
                    const expenseData = {
                        ...formData,
                        amount: parseFloat(formData.amount),
                        category_id: parseInt(formData.category_id),
                        day_of_month: parseInt(formData.day_of_month)
                    };
                    delete expenseData.categoryId;
                    delete expenseData.dayOfMonth;

                    if (editingExpense) {
                        await fixedExpensesAPI.update(editingExpense.id, expenseData);
                    } else {
                        await fixedExpensesAPI.create(expenseData);
                    }
                    loadFixedExpenses();
                    handleCloseModal();
                } catch (error) {
                    console.error('Erro ao salvar despesa fixa:', error);
                    alert('Erro ao salvar despesa fixa');
                }
            };

            const handleDelete = async (id) => {
                if (confirm('Tem certeza que deseja excluir esta despesa fixa?')) {
                    try {
                        await fixedExpensesAPI.delete(id);
                        loadFixedExpenses();
                    } catch (error) {
                        console.error('Erro ao excluir despesa fixa:', error);
                        alert('Erro ao excluir despesa fixa');
                    }
                }
            };

            const handleEdit = (expense) => {
                setEditingExpense(expense);
                setFormData({
                    description: expense.description,
                    amount: expense.amount.toString(),
                    category_id: expense.category_id.toString(),
                    day_of_month: expense.day_of_month.toString()
                });
                setShowModal(true);
            };

            const handleCloseModal = () => {
                setShowModal(false);
                setEditingExpense(null);
                setFormData({
                    description: '',
                    amount: '',
                    category_id: '',
                    day_of_month: ''
                });
            };

            return (
                <div>
                    <h1 style={{color: '#333', marginBottom: '30px'}}>Despesas Fixas</h1>
                    
                    <button className="btn" onClick={() => setShowModal(true)} style={{marginBottom: '20px'}}>
                        Nova Despesa Fixa
                    </button>

                    <div className="dashboard-card">
                        <h3>Lista de Despesas Fixas</h3>
                        {loading ? (
                            <div>Carregando...</div>
                        ) : fixedExpenses.length > 0 ? (
                            <div className="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Descrição</th>
                                            <th>Categoria</th>
                                            <th>Valor</th>
                                            <th>Dia do Mês</th>
                                            <th>Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {fixedExpenses.map(expense => {
                                            const category = categories.find(c => c.id === expense.category_id);
                                            return (
                                                <tr key={expense.id}>
                                                    <td>{expense.description}</td>
                                                    <td>{category?.name || 'Sem categoria'}</td>
                                                    <td>R$ {parseFloat(expense.amount).toFixed(2)}</td>
                                                    <td>Dia {expense.day_of_month}</td>
                                                    <td>
                                                        <div className="action-buttons">
                                                            <button className="btn btn-secondary" onClick={() => handleEdit(expense)}>
                                                                Editar
                                                            </button>
                                                            <button className="btn btn-danger" onClick={() => handleDelete(expense.id)}>
                                                                Excluir
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                        ) : (
                            <div className="empty-state">
                                <p>Nenhuma despesa fixa cadastrada</p>
                            </div>
                        )}
                    </div>

                    {showModal && (
                        <div className="modal-overlay" onClick={handleCloseModal}>
                            <div className="modal" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <h3>{editingExpense ? 'Editar Despesa Fixa' : 'Nova Despesa Fixa'}</h3>
                                    <button className="close-btn" onClick={handleCloseModal}>×</button>
                                </div>
                                <form onSubmit={handleSubmit}>
                                    <div className="form-group">
                                        <label>Descrição</label>
                                        <input
                                            type="text"
                                            required
                                            value={formData.description}
                                            onChange={(e) => setFormData({...formData, description: e.target.value})}
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>Valor</label>
                                        <input
                                            type="number"
                                            step="0.01"
                                            required
                                            value={formData.amount}
                                            onChange={(e) => setFormData({...formData, amount: e.target.value})}
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>Categoria</label>
                                        <select
                                            required
                                            value={formData.category_id}
                                            onChange={(e) => setFormData({...formData, category_id: e.target.value})}
                                        >
                                            <option value="">Selecione...</option>
                                            {categories.map(category => (
                                                <option key={category.id} value={category.id}>
                                                    {category.name}
                                                </option>
                                            ))}
                                        </select>
                                    </div>
                                    <div className="form-group">
                                        <label>Dia do Mês (1-31)</label>
                                        <input
                                            type="number"
                                            min="1"
                                            max="31"
                                            required
                                            value={formData.day_of_month}
                                            onChange={(e) => setFormData({...formData, day_of_month: e.target.value})}
                                        />
                                    </div>
                                    <button type="submit" className="btn">
                                        {editingExpense ? 'Salvar' : 'Adicionar'}
                                    </button>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const Income = () => {
            const [income, setIncome] = useState({
                fixed_amount: 0,
                bonus_amount: 0
            });
            const [variableIncomes, setVariableIncomes] = useState([]);
            const [fixedIncomes, setFixedIncomes] = useState([]);
            const [showVariableModal, setShowVariableModal] = useState(false);
            const [showFixedModal, setShowFixedModal] = useState(false);
            const [editingVariable, setEditingVariable] = useState(null);
            const [editingFixed, setEditingFixed] = useState(null);
            const [variableForm, setVariableForm] = useState({
                description: '',
                amount: '',
                valid_until: '',
                is_active: true
            });
            const [fixedForm, setFixedForm] = useState({
                description: '',
                amount: '',
                valid_until: '',
                is_active: true
            });
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                loadIncome();
            }, []);

            const loadIncome = async () => {
                try {
                    const [incomeData, variableData, fixedData] = await Promise.all([
                        incomeAPI.get(),
                        incomeAPI.listVariable(),
                        incomeAPI.listFixed()
                    ]);
                    setIncome(incomeData);
                    setVariableIncomes(variableData);
                    setFixedIncomes(fixedData);
                } catch (error) {
                    console.error('Erro ao carregar receitas:', error);
                } finally {
                    setLoading(false);
                }
            };

            const handleFixedChange = async (value) => {
                try {
                    await incomeAPI.update({
                        fixed_amount: parseFloat(value) || 0,
                        bonus_amount: income.bonus_amount
                    });
                    setIncome(prev => ({ ...prev, fixed_amount: parseFloat(value) || 0 }));
                } catch (error) {
                    console.error('Erro ao atualizar receita fixa:', error);
                    alert('Erro ao atualizar receita fixa');
                }
            };

            const handleFixedSubmit = async (e) => {
                e.preventDefault();
                try {
                    const fixedData = {
                        ...fixedForm,
                        amount: parseFloat(fixedForm.amount)
                    };

                    if (editingFixed) {
                        await incomeAPI.updateFixed(editingFixed.id, fixedData);
                    } else {
                        await incomeAPI.createFixed(fixedData);
                    }
                    loadIncome();
                    handleCloseFixedModal();
                } catch (error) {
                    console.error('Erro ao salvar receita fixa:', error);
                    alert('Erro ao salvar receita fixa');
                }
            };

            const handleDeleteFixed = async (id) => {
                if (confirm('Tem certeza que deseja excluir esta receita fixa?')) {
                    try {
                        await incomeAPI.deleteFixed(id);
                        loadIncome();
                    } catch (error) {
                        console.error('Erro ao excluir receita fixa:', error);
                        alert('Erro ao excluir receita fixa');
                    }
                }
            };

            const handleEditFixed = (fixed) => {
                setEditingFixed(fixed);
                setFixedForm({
                    description: fixed.description,
                    amount: fixed.amount.toString(),
                    valid_until: fixed.valid_until,
                    is_active: fixed.is_active
                });
                setShowFixedModal(true);
            };

            const handleCloseFixedModal = () => {
                setShowFixedModal(false);
                setEditingFixed(null);
                setFixedForm({
                    description: '',
                    amount: '',
                    valid_until: '',
                    is_active: true
                });
            };

            const handleVariableSubmit = async (e) => {
                e.preventDefault();
                try {
                    const variableData = {
                        ...variableForm,
                        amount: parseFloat(variableForm.amount)
                    };
                    delete variableData.validUntil;

                    if (editingVariable) {
                        await incomeAPI.updateVariable(editingVariable.id, variableData);
                    } else {
                        await incomeAPI.createVariable(variableData);
                    }
                    loadIncome();
                    handleCloseVariableModal();
                } catch (error) {
                    console.error('Erro ao salvar receita variável:', error);
                    alert('Erro ao salvar receita variável');
                }
            };

            const handleDeleteVariable = async (id) => {
                if (confirm('Tem certeza que deseja excluir esta receita variável?')) {
                    try {
                        await incomeAPI.deleteVariable(id);
                        loadIncome();
                    } catch (error) {
                        console.error('Erro ao excluir receita variável:', error);
                        alert('Erro ao excluir receita variável');
                    }
                }
            };

            const handleEditVariable = (variable) => {
                setEditingVariable(variable);
                setVariableForm({
                    description: variable.description,
                    amount: variable.amount.toString(),
                    valid_until: variable.valid_until,
                    is_active: variable.is_active
                });
                setShowVariableModal(true);
            };

            const handleCloseVariableModal = () => {
                setShowVariableModal(false);
                setEditingVariable(null);
                setVariableForm({
                    description: '',
                    amount: '',
                    valid_until: '',
                    is_active: true
                });
            };

            if (loading) {
                return <div>Carregando...</div>;
            }



            return (
                <div>
                    <h1 style={{color: '#333', marginBottom: '30px'}}>Receitas</h1>
                    
                    <div className="stats-grid">
                        <div className="stat-card">
                            <h4>Receita Total Líquida</h4>
                            <div className="value">R$ {(parseFloat(income.fixed_amount) + variableIncomes.reduce((sum, v) => sum + parseFloat(v.amount), 0) + fixedIncomes.reduce((sum, f) => sum + parseFloat(f.amount), 0)).toFixed(2)}</div>
                        </div>
                    </div>

                    <div className="dashboard-card">
                        <h3>Receita Mensal Fixa</h3>
                        <div className="form-group">
                            <label>Valor Fixo Mensal</label>
                            <input
                                type="number"
                                step="0.01"
                                value={income.fixed_amount}
                                onChange={(e) => handleFixedChange(e.target.value)}
                                placeholder="0.00"
                            />
                        </div>
                    </div>

                    <div className="dashboard-card">
                        <h3>Receitas Fixas</h3>
                        <button className="btn" onClick={() => setShowFixedModal(true)} style={{marginBottom: '20px'}}>
                            Adicionar Receita Fixa
                        </button>

                        {fixedIncomes.length > 0 ? (
                            <div className="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Descrição</th>
                                            <th>Valor</th>
                                            <th>Válido Até</th>
                                            <th>Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {fixedIncomes.map(fixed => (
                                            <tr key={fixed.id}>
                                                <td>{fixed.description}</td>
                                                <td>R$ {parseFloat(fixed.amount).toFixed(2)}</td>
                                                <td>{fixed.valid_until ? new Date(fixed.valid_until).toLocaleDateString('pt-BR') : 'Indefinido'}</td>
                                                <td>
                                                    <div className="action-buttons">
                                                        <button className="btn btn-secondary" onClick={() => handleEditFixed(fixed)}>
                                                            Editar
                                                        </button>
                                                        <button className="btn btn-danger" onClick={() => handleDeleteFixed(fixed.id)}>
                                                            Excluir
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        ) : (
                            <div className="empty-state">
                                <p>Nenhuma receita fixa cadastrada</p>
                            </div>
                        )}
                    </div>

                    <div className="dashboard-card">
                        <h3>Receitas Variáveis</h3>
                        <button className="btn" onClick={() => setShowVariableModal(true)} style={{marginBottom: '20px'}}>
                            Adicionar Receita Variável
                        </button>

                        {variableIncomes.length > 0 ? (
                            <div className="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Descrição</th>
                                            <th>Valor</th>
                                            <th>Válido Até</th>
                                            <th>Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {variableIncomes.map(variable => (
                                            <tr key={variable.id}>
                                                <td>{variable.description}</td>
                                                <td>R$ {parseFloat(variable.amount).toFixed(2)}</td>
                                                <td>{variable.valid_until ? new Date(variable.valid_until).toLocaleDateString('pt-BR') : 'Indefinido'}</td>
                                                <td>
                                                    <div className="action-buttons">
                                                        <button className="btn btn-secondary" onClick={() => handleEditVariable(variable)}>
                                                            Editar
                                                        </button>
                                                        <button className="btn btn-danger" onClick={() => handleDeleteVariable(variable.id)}>
                                                            Excluir
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        ) : (
                            <div className="empty-state">
                                <p>Nenhuma receita variável cadastrada</p>
                            </div>
                        )}
                    </div>


                    {showFixedModal && (
                        <div className="modal-overlay" onClick={handleCloseFixedModal}>
                            <div className="modal" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <h3>{editingFixed ? 'Editar Receita Fixa' : 'Nova Receita Fixa'}</h3>
                                    <button className="close-btn" onClick={handleCloseFixedModal}>×</button>
                                </div>
                                <form onSubmit={handleFixedSubmit}>
                                    <div className="form-group">
                                        <label>Descrição</label>
                                        <input
                                            type="text"
                                            required
                                            value={fixedForm.description}
                                            onChange={(e) => setFixedForm({...fixedForm, description: e.target.value})}
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>Valor</label>
                                        <input
                                            type="number"
                                            step="0.01"
                                            required
                                            value={fixedForm.amount}
                                            onChange={(e) => setFixedForm({...fixedForm, amount: e.target.value})}
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>Válido Até</label>
                                        <input
                                            type="date"
                                            value={fixedForm.valid_until}
                                            onChange={(e) => setFixedForm({...fixedForm, valid_until: e.target.value})}
                                        />
                                    </div>
                                    <button type="submit" className="btn">
                                        {editingFixed ? 'Salvar' : 'Adicionar'}
                                    </button>
                                </form>
                            </div>
                        </div>
                    )}

                    {showVariableModal && (
                        <div className="modal-overlay" onClick={handleCloseVariableModal}>
                            <div className="modal" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <h3>{editingVariable ? 'Editar Receita Variável' : 'Nova Receita Variável'}</h3>
                                    <button className="close-btn" onClick={handleCloseVariableModal}>×</button>
                                </div>
                                <form onSubmit={handleVariableSubmit}>
                                    <div className="form-group">
                                        <label>Descrição</label>
                                        <input
                                            type="text"
                                            required
                                            value={variableForm.description}
                                            onChange={(e) => setVariableForm({...variableForm, description: e.target.value})}
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>Valor</label>
                                        <input
                                            type="number"
                                            step="0.01"
                                            required
                                            value={variableForm.amount}
                                            onChange={(e) => setVariableForm({...variableForm, amount: e.target.value})}
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>Válido Até</label>
                                        <input
                                            type="date"
                                            value={variableForm.valid_until}
                                            onChange={(e) => setVariableForm({...variableForm, valid_until: e.target.value})}
                                        />
                                    </div>
                                    <button type="submit" className="btn">
                                        {editingVariable ? 'Salvar' : 'Adicionar'}
                                    </button>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const Reports = () => {
            const [reportType, setReportType] = useState('mensal');
            const [categoryFilter, setCategoryFilter] = useState('');
            const [categories, setCategories] = useState([]);
            const [reportData, setReportData] = useState(null);
            const [loading, setLoading] = useState(false);

            useEffect(() => {
                loadCategories();
            }, []);

            const loadCategories = async () => {
                try {
                    const data = await categoriesAPI.list();
                    setCategories(data);
                } catch (error) {
                    console.error('Erro ao carregar categorias:', error);
                }
            };

            const generateReport = async () => {
                setLoading(true);
                try {
                    const now = new Date();
                    const params = {
                        type: reportType,
                        month: now.getMonth() + 1,
                        year: now.getFullYear()
                    };

                    if (categoryFilter && categoryFilter !== '') {
                        params.category_id = categoryFilter;
                    }

                    const data = await reportsAPI.generate(params);
                    setReportData({
                        ...data,
                        period: reportType === 'mensal' ? `${now.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' })}` : now.getFullYear()
                    });
                } catch (error) {
                    console.error('Erro ao gerar relatório:', error);
                    alert('Erro ao gerar relatório');
                } finally {
                    setLoading(false);
                }
            };

            const downloadPDF = async () => {
                if (!reportData) return;

                try {
                    const now = new Date();
                    const params = {
                        type: reportType,
                        month: now.getMonth() + 1,
                        year: now.getFullYear()
                    };

                    if (categoryFilter && categoryFilter !== '') {
                        params.category_id = categoryFilter;
                    }

                    const response = await fetch(`${API_BASE}/reports/pdf/?${new URLSearchParams(params)}`, {
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('token')}`
                        }
                    });

                    if (!response.ok) {
                        throw new Error('Erro ao baixar PDF');
                    }

                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `relatorio-${reportType}-${now.getFullYear()}-${now.getMonth() + 1}.pdf`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                } catch (error) {
                    console.error('Erro ao baixar PDF:', error);
                    alert('Erro ao baixar PDF');
                }
            };

            const sendEmail = async () => {
                if (!reportData) return;

                const email = prompt('Digite o email para enviar o relatório:');
                if (!email) return;

                try {
                    const now = new Date();
                    const params = {
                        type: reportType,
                        month: now.getMonth() + 1,
                        year: now.getFullYear(),
                        email: email
                    };

                    if (categoryFilter && categoryFilter !== '') {
                        params.category_id = categoryFilter;
                    }

                    const response = await fetch(`${API_BASE}/reports/email/`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${localStorage.getItem('token')}`
                        },
                        body: JSON.stringify(params)
                    });

                    if (!response.ok) {
                        throw new Error('Erro ao enviar email');
                    }

                    alert('Relatório enviado por email com sucesso!');
                } catch (error) {
                    console.error('Erro ao enviar email:', error);
                    alert('Erro ao enviar email');
                }
            };

            return (
                <div>
                    <h1 style={{color: '#333', marginBottom: '30px'}}>Relatórios</h1>
                    
                    <div className="dashboard-card">
                        <h3>Configurações do Relatório</h3>
                        <div className="filter-container">
                            <select value={reportType} onChange={(e) => setReportType(e.target.value)}>
                                <option value="mensal">Mensal</option>
                                <option value="anual">Anual</option>
                                <option value="categoria">Por Categoria</option>
                            </select>
                            {reportType === 'categoria' && (
                                <select value={categoryFilter} onChange={(e) => setCategoryFilter(e.target.value)}>
                                    <option value="">Selecione uma categoria</option>
                                    {categories.map(cat => (
                                        <option key={cat.id} value={cat.id}>{cat.name}</option>
                                    ))}
                                </select>
                            )}
                            <button className="btn" onClick={generateReport} disabled={loading}>
                                {loading ? 'Gerando...' : 'Gerar Relatório'}
                            </button>
                        </div>
                    </div>

                    {reportData && (
                        <div className="dashboard-card">
                            <h3>Relatório {reportData.type === 'mensal' ? 'Mensal' : reportData.type === 'anual' ? 'Anual' : 'Por Categoria'} - {reportData.period}</h3>

                            <div className="stats-grid" style={{marginBottom: '30px'}}>
                                <div className="stat-card">
                                    <h4>Receita Total</h4>
                                    <div className="value">R$ {parseFloat(reportData.total_income).toFixed(2)}</div>
                                </div>
                                <div className="stat-card">
                                    <h4>Despesas Total</h4>
                                    <div className="value">R$ {parseFloat(reportData.total_expense).toFixed(2)}</div>
                                </div>
                                <div className="stat-card">
                                    <h4>Saldo</h4>
                                    <div className="value">R$ {parseFloat(reportData.balance).toFixed(2)}</div>
                                </div>
                            </div>

                            <div className="action-buttons" style={{marginBottom: '20px'}}>
                                <button className="btn btn-success" onClick={downloadPDF}>
                                    Baixar PDF
                                </button>
                                <button className="btn" onClick={sendEmail}>
                                    Enviar por Email
                                </button>
                            </div>

                            {reportData.transactions && reportData.transactions.length > 0 ? (
                                <div className="table-container">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Data</th>
                                                <th>Descrição</th>
                                                <th>Tipo</th>
                                                <th>Valor</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {reportData.transactions.map((transaction, index) => (
                                                <tr key={`${transaction.id}-${index}`}>
                                                    <td>{new Date(transaction.date).toLocaleDateString('pt-BR')}</td>
                                                    <td>{transaction.description}</td>
                                                    <td>
                                                        <span className={`badge ${transaction.type === 'receita' ? 'badge-success' : 'badge-danger'}`}>
                                                            {transaction.type}
                                                        </span>
                                                    </td>
                                                    <td>R$ {parseFloat(transaction.amount).toFixed(2)}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            ) : (
                                <div className="empty-state">
                                    <p>Nenhuma transação encontrada para o período selecionado</p>
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        };

        const Analysis = () => {
            const [filter, setFilter] = useState('entradas');
            const [period, setPeriod] = useState('mensal');
            const [chartData, setChartData] = useState([]);

            useEffect(() => {
                generateChartData();
            }, [filter, period]);

            const generateChartData = () => {
                const expenses = JSON.parse(localStorage.getItem('expenses') || '[]');
                const income = JSON.parse(localStorage.getItem('income') || '{}');
                const categories = JSON.parse(localStorage.getItem('categories') || '[]');
                
                const now = new Date();
                let data = [];

                if (filter === 'entradas') {
                    if (period === 'mensal') {
                        data = [
                            { name: 'Receita Fixa', value: income.fixed || 0 },
                            { name: 'Receita Variável', value: income.variable?.reduce((sum, v) => sum + v.amount, 0) || 0 },
                
                        ];
                    } else {
                        const months = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
                        data = months.map((month, index) => ({
                            name: month,
                            value: (income.fixed || 0)
                        }));
                    }
                } else if (filter === 'saidas') {
                    const filteredExpenses = expenses.filter(e => e.type === 'despesa');
                    
                    if (period === 'mensal') {
                        const monthlyExpenses = filteredExpenses.filter(e => {
                            const date = new Date(e.date);
                            return date.getMonth() === now.getMonth() && date.getFullYear() === now.getFullYear();
                        });
                        
                        const expensesByCategory = {};
                        monthlyExpenses.forEach(expense => {
                            const category = categories.find(c => c.id === expense.categoryId);
                            const categoryName = category?.name || 'Sem categoria';
                            expensesByCategory[categoryName] = (expensesByCategory[categoryName] || 0) + expense.amount;
                        });
                        
                        data = Object.entries(expensesByCategory).map(([name, value]) => ({
                            name,
                            value
                        }));
                    } else {
                        const months = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
                        data = months.map(month => {
                            const monthIndex = months.indexOf(month);
                            const monthlyExpenses = filteredExpenses.filter(e => {
                                const date = new Date(e.date);
                                return date.getMonth() === monthIndex && date.getFullYear() === now.getFullYear();
                            });
                            return {
                                name: month,
                                value: monthlyExpenses.reduce((sum, e) => sum + e.amount, 0)
                            };
                        });
                    }
                }

                setChartData(data);
            };

            const maxValue = Math.max(...chartData.map(d => d.value), 1);

            return (
                <div>
                    <h1 style={{color: '#333', marginBottom: '30px'}}>Análises</h1>
                    
                    <div className="dashboard-card">
                        <h3>Filtros</h3>
                        <div className="filter-container">
                            <select value={filter} onChange={(e) => setFilter(e.target.value)}>
                                <option value="entradas">Entradas</option>
                                <option value="saidas">Saídas</option>
                            </select>
                            <select value={period} onChange={(e) => setPeriod(e.target.value)}>
                                <option value="mensal">Mensal</option>
                                <option value="anual">Anual</option>
                            </select>
                        </div>
                    </div>

                    <div className="dashboard-card">
                        <h3>Visualização - {filter === 'entradas' ? 'Entradas' : 'Saídas'} ({period === 'mensal' ? 'Mensal' : 'Anual'})</h3>
                        <div className="chart-container">
                            <div className="simple-chart">
                                <div className="bar-chart">
                                    {chartData.map((item, index) => (
                                        <div 
                                            key={index}
                                            className="bar" 
                                            style={{
                                                height: `${(item.value / maxValue) * 100}%`,
                                                minHeight: '20px'
                                            }}
                                        >
                                            <div className="bar-value">
                                                R$ {item.value.toFixed(0)}
                                            </div>
                                            <div className="bar-label">
                                                {item.name}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const Settings = ({ currentUser, setCurrentUser }) => {
            const [formData, setFormData] = useState({
                name: currentUser?.name || '',
                email: currentUser?.email || '',
                password: '',
                newPassword: ''
            });
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);

                try {
                    const updateData = {
                        name: formData.name,
                        email: formData.email
                    };

                    if (formData.newPassword) {
                        updateData.password = formData.newPassword;
                    }

                    const updatedUser = await authAPI.updateProfile(updateData);

                    // Atualizar o estado local e localStorage
                    localStorage.setItem('currentUser', JSON.stringify(updatedUser));
                    setCurrentUser(updatedUser);

                    alert('Configurações salvas com sucesso!');
                } catch (error) {
                    console.error('Erro ao salvar configurações:', error);
                    alert('Erro ao salvar configurações. Tente novamente.');
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div>
                    <h1 style={{color: '#333', marginBottom: '30px'}}>Configurações</h1>
                    
                    <div className="dashboard-card">
                        <h3>Perfil do Usuário</h3>
                        <div className="profile-section">
                            <div className="profile-avatar">
                                {currentUser?.avatar || currentUser?.name?.charAt(0).toUpperCase() || 'U'}
                            </div>
                            <div style={{flex: 1}}>
                                <h2 style={{color: '#333', marginBottom: '10px'}}>{currentUser?.name || 'Usuário'}</h2>
                                <p style={{color: '#666'}}>{currentUser?.email || 'email@exemplo.com'}</p>
                            </div>
                        </div>
                    </div>

                    <div className="dashboard-card">
                        <h3>Editar Informações</h3>
                        <form onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label>Nome</label>
                                <input
                                    type="text"
                                    value={formData.name}
                                    onChange={(e) => setFormData({...formData, name: e.target.value})}
                                />
                            </div>
                            <div className="form-group">
                                <label>Email</label>
                                <input
                                    type="email"
                                    value={formData.email}
                                    onChange={(e) => setFormData({...formData, email: e.target.value})}
                                />
                            </div>
                            <div className="form-group">
                                <label>Nova Senha (deixe em branco para manter a atual)</label>
                                <input
                                    type="password"
                                    value={formData.newPassword}
                                    onChange={(e) => setFormData({...formData, newPassword: e.target.value})}
                                    placeholder="Nova senha"
                                />
                            </div>
                            <button type="submit" className="btn" disabled={loading}>
                                {loading ? 'Salvando...' : 'Salvar Alterações'}
                            </button>
                        </form>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>